<div align="center">

```
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
â•šâ•â•     â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•
```

# ğŸš€ **Parallel Distributed Shell**

### *Execute commands on multiple remote hosts in parallel*

**Because life's too short to SSH into servers one by one** ğŸ¯

[![License](https://img.shields.io/badge/License-GPL-blue.svg)](COPYING)
[![C](https://img.shields.io/badge/Language-C-00599C.svg)](src/)
[![Platform](https://img.shields.io/badge/Platform-Linux%20%7C%20Unix-lightgrey.svg)]()
[![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg)]()

[Features](#-key-features) â€¢ [Quick Start](#-quick-start) â€¢ [Installation](#-installation) â€¢ [Configuration](#%EF%B8%8F-configuration) â€¢ [Documentation](#-documentation)

</div>

---

## âœ¨ What is PDSH?

**Pdsh** is a high-performance, multithreaded remote shell client that executes commands on multiple remote hosts **in parallel**. Whether you're managing 10 servers or 10,000 nodes, pdsh scales effortlessly to match your infrastructure.

```bash
# Run a command on 100 servers simultaneously
$ pdsh -w server[1-100] uptime

# Copy files to multiple hosts in parallel
$ pdcp -w web[1-20] index.html /var/www/html/

# Get system info from your entire cluster
$ pdsh -a "uname -r | sort -u"
```

---

## ğŸ¯ Key Features

<table>
<tr>
<td width="50%">

### âš¡ **Lightning Fast**
Execute commands across thousands of nodes in parallel with configurable fanout control

### ğŸ”Œ **Protocol Agnostic**
Built-in support for SSH, RSH, Kerberos IV, mrsh, and more

</td>
<td width="50%">

### ğŸ§µ **Multithreaded**
Efficient connection pooling and thread management for optimal performance

### ğŸ›ï¸ **Highly Configurable**
Modular architecture with dynamically loadable plugins

</td>
</tr>
</table>

### ğŸ’ª Why Choose PDSH?

| Without PDSH | With PDSH |
|--------------|-----------|
| `for host in $(cat servers.txt); do ssh $host uptime; done` | `pdsh -w ^servers.txt uptime` |
| â±ï¸ Sequential execution = slow | âš¡ Parallel execution = **blazing fast** |
| ğŸ˜´ 100 servers Ã— 2 seconds = 3+ minutes | ğŸš€ 100 servers in ~2 seconds (fanout=32) |
| ğŸ˜« Manual output parsing | ğŸ¨ Formatted, labeled output per host |

---

## ğŸš€ Quick Start

### Prerequisites

```bash
# Debian/Ubuntu
sudo apt-get install build-essential autoconf automake

# RHEL/CentOS/Fedora
sudo yum install gcc autoconf automake

# macOS
brew install autoconf automake
```

### Build & Install

```bash
# Clone the repository
git clone https://github.com/chaos/pdsh.git
cd pdsh

# Bootstrap the build system
./bootstrap

# Configure with your preferred options (SSH recommended)
./configure --with-ssh --with-readline

# Build and install
make
sudo make install
```

### Your First Command

```bash
# Execute on multiple hosts
pdsh -w "host1,host2,host3" hostname

# Use range expressions
pdsh -w "node[1-100]" "df -h | grep -w /"

# Target all hosts in a file
pdsh -w ^/path/to/hostlist.txt uptime
```

---

## âš™ï¸ Configuration

Pdsh uses **GNU autoconf** for configuration. Dynamically loadable modules for each shell service and feature are compiled based on your configuration.

> **Default modules**: rsh, Kerberos IV, and SDR (for IBM SPs) are compiled automatically if available on your system.

### ğŸ“¦ Available Modules

For a complete description of each module, including requirements and conflicts, see the [`README.modules`](README.modules) file.

### ğŸ”§ Static Module Compilation

If your system doesn't support dynamically loadable modules, use:

```bash
./configure --enable-static-modules
```

---

## ğŸ› ï¸ Build Configuration Options

Configure pdsh with additional features using these options:

### ğŸ” Remote Shell Services

| Option | Description |
|--------|-------------|
| `--without-rsh` | Disable BSD rcmd(3) support (standard rsh) |
| `--with-ssh` | âœ… Enable SSH remote shell service |
| `--with-mrsh` | âœ… Enable mrsh(1) remote shell service |

### ğŸ—‚ï¸ Host Management

| Option | Description |
|--------|-------------|
| `--with-machines=/path/to/machines` | Use flat file list for `-a` option |
| `--with-genders` | âœ… Support genders database via genders(3) library |
| `--with-dshgroups` | âœ… Support dsh-style group files (`~/.dsh/group/`) |
| `--with-netgroup` | âœ… Use netgroups (`/etc/netgroup` or NIS) |

### ğŸ® Runtime Features

| Option | Description |
|--------|-------------|
| `--with-nodeupdown` | âœ… Dynamic elimination of down nodes via nodeupdown(3) |
| `--with-slurm` | âœ… Support running under SLURM allocation |
| `--with-readline` | âœ… GNU readline for interactive mode |

### âš¡ Performance Tuning

| Option | Default | Description |
|--------|---------|-------------|
| `--with-fanout=N` | 32 | Set default parallel connection fanout |
| `--with-timeout=N` | 10 | Set default connect timeout (seconds) |

### ğŸ“ Configuration Examples

<details>
<summary><b>ğŸ¯ Recommended: SSH with Full Features</b></summary>

```bash
./configure \
  --with-ssh \
  --with-genders \
  --with-slurm \
  --with-readline \
  --with-fanout=64 \
  --with-timeout=15
```

Perfect for modern infrastructure with SSH access and SLURM job scheduling.
</details>

<details>
<summary><b>âš¡ Minimal: SSH Only</b></summary>

```bash
./configure --with-ssh
```

Lightweight configuration for basic SSH-based parallel execution.
</details>

<details>
<summary><b>ğŸ¢ Enterprise: All Features Enabled</b></summary>

```bash
./configure \
  --with-ssh \
  --with-mrsh \
  --with-genders \
  --with-dshgroups \
  --with-netgroup \
  --with-nodeupdown \
  --with-slurm \
  --with-readline \
  --with-fanout=128 \
  --with-timeout=20
```

Maximum functionality for large-scale HPC environments.
</details>

### âš ï¸ Module Conflicts

Some configuration options may conflict because they perform identical operations. For example:
- `genders` and `nodeattr` both support the `-g` option
- When multiple modules support the same option, one will be selected as default
- Static compilation will **fail** if conflicting modules are selected

ğŸ“– See the man page for details on which modules conflict.

---

## ğŸ“¦ Installation

### Quick Install

```bash
# Build the project
make

# Install system-wide (requires root)
sudo make install

# Verify installation
pdsh -V
```

### ğŸ”’ SetUID Configuration (Optional)

By default, pdsh installs **without setuid permissions**. For most protocols, root permissions aren't needed.

**However**, if you're using `rcmd/rsh` or `rcmd/qsh` modules, you'll need setuid root:

```bash
chown root PREFIX/bin/pdsh PREFIX/bin/pdcp
chmod 4755 PREFIX/bin/pdsh PREFIX/bin/pdcp
```

---

## ğŸ’¡ Usage Examples

### Basic Operations

```bash
# Execute on specific hosts
pdsh -w host1,host2,host3 date

# Use range expressions for large sets
pdsh -w node[001-100] "ps aux | grep apache"

# Read hostlist from file
pdsh -w ^/etc/pdsh/hosts uptime

# Exclude specific hosts
pdsh -w node[1-50] -x node[5,10,15] reboot
```

### Real-World Scenarios

```bash
# Update all web servers
pdsh -w web[1-20] "sudo apt-get update && sudo apt-get upgrade -y"

# Check disk space across cluster
pdsh -a "df -h | grep -w /" | dshbak -c

# Restart service on all app servers
pdsh -w app[01-10] "sudo systemctl restart nginx"

# Deploy configuration file
pdcp -w db[1-5] /local/config.cnf /etc/mysql/

# Gather logs from all nodes
pdsh -w ^cluster.txt "tail -100 /var/log/syslog" > cluster_logs.txt
```

### Advanced Patterns

```bash
# Interactive mode with readline
pdsh -w web[1-10]

# Custom fanout for rate limiting
pdsh -f 5 -w server[1-100] "heavy-command"

# With timeout control
pdsh -u 30 -w node[1-50] "slow-operation"

# Combine with pipes and filters
pdsh -w compute[01-99] "cat /proc/cpuinfo" | dshbak -c | grep "model name" | sort -u
```

---

## âš ï¸ Gotchas & Known Issues

<details>
<summary><b>1ï¸âƒ£ Reserved Socket Exhaustion</b></summary>

When using rsh, krb4, qsh, or ssh, pdsh uses **reserved sockets** (obtained via `rresvport()`):
- One socket per active connection (two if maintaining separate stderr)
- Pool of 256 sockets available
- Can be exhausted with:
  - Multiple pdsh instances running simultaneously
  - Very high fanout settings

ğŸ’¡ **Solution**: Use mrsh/mqsh (no reserved ports) or reduce fanout with `--with-fanout=N`
</details>

<details>
<summary><b>2ï¸âƒ£ TCP Wrappers Bottlenecks</b></summary>

When using remote shell services wrapped with TCP wrappers, watch for bottlenecks:

| Service | Impact |
|---------|--------|
| **IDENT** | With `user@` in hosts.allow, each connection triggers IDENT query |
| **DNS** | Each connection may trigger DNS lookup |
| **SYSLOG** | Each connection creates syslog entry on loghost |

ğŸ’¡ **Mitigation strategies**:
- Configure without "PARANOID" option
- Use IP addresses or subnets (avoid names and `user@` prefix)
- Set SYSLOG severity to avoid remote logging
- Reduce default fanout if needed
</details>

---

## ğŸ§  Theory of Operation

<details>
<summary><b>ğŸ“ Click to expand architecture details</b></summary>

> Generalized for the common remote shell service (rsh). Similar for SSH, Kerberos IV, qsh, etc.

### Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Main Thread                         â”‚
â”‚  - Starts fanout number of rsh threads                      â”‚
â”‚  - Waits on condition variable                              â”‚
â”‚  - Maintains fanout until all commands complete             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                   â†“                   â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Thread  â”‚         â”‚ Thread  â”‚   ...   â”‚ Thread  â”‚
   â”‚    1    â”‚         â”‚    2    â”‚         â”‚    N    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚                   â”‚
        â†“                   â†“                   â†“
   [Node 1]            [Node 2]            [Node N]
```

### Thread Workflow

1. **Thread Creation** - One thread per remote connection
2. **Connection** - MT-safe rcmd-like function opens connection
3. **I/O Streams** - Returns stdin and stderr streams
4. **Termination** - Thread signals completion and terminates
5. **Fanout Management** - Main thread starts new threads to maintain fanout

### Timeout Management

A dedicated **timeout thread** monitors all connection threads:
- Terminates threads taking too long to connect
- Enforces command completion timeouts (if requested)

### ğŸ¹ Interactive Controls

| Key Combo | Action |
|-----------|--------|
| `^C` (first) | List threads in connected state |
| `^C` (second) | Terminate program immediately |

</details>

---

## ğŸ“š Documentation

### ğŸ“– Man Pages

```bash
man pdsh          # Main program documentation
man pdcp          # Parallel copy utility
man dshbak        # Output formatter
```

### ğŸ“¦ Additional Resources

- **[Module Documentation](README.modules)** - Detailed info on all available modules
- **[Installation Guide](INSTALL)** - Platform-specific installation instructions
- **[Author & Contributors](AUTHORS)** - Project contributors

---

## ğŸ¤ Contributing

We welcome contributions! Here's how you can help:

- ğŸ› **Report bugs** - Open an issue with detailed reproduction steps
- ğŸ’¡ **Suggest features** - Share your ideas for improvements
- ğŸ“ **Improve docs** - Help us make the documentation better
- ğŸ”§ **Submit PRs** - Fix bugs or add features

---

## ğŸ‘¨â€ğŸ’» Author & Maintainers

**Original Author**: Jim Garlick - [garlick@llnl.gov](mailto:garlick@llnl.gov)

### ğŸ’Œ Feedback Welcome

Please send:
- ğŸ› Bug reports
- ğŸ’¡ Suggestions
- ğŸ“Š Usage reports (we'd love to hear about your cluster size!)

---

## ğŸ“„ License & Attribution

This product includes software developed by the **University of California, Berkeley** and its contributors.

ğŸ“œ **License**: GPL - See [COPYING](COPYING) for full details

### â„¹ï¸ Disclaimer

The PDSH software package has **no affiliation** with the Democratic Party of Albania ([www.pdsh.org](http://www.pdsh.org)). ğŸ‡¦ğŸ‡±

---

## â­ Show Your Support

If PDSH makes your life easier, consider:

- â­ **Starring this repo** on GitHub
- ğŸ“¢ **Spreading the word** to fellow sysadmins
- ğŸ› **Contributing** bug reports or code
- ğŸ“Š **Sharing** your use case (managing how many nodes?)

---

<div align="center">

### ğŸ”— Quick Links

**[ğŸ“– Documentation](doc/)** â€¢ **[ğŸ”Œ Modules](README.modules)** â€¢ **[ğŸ‘¥ Contributors](AUTHORS)** â€¢ **[ğŸ“ License](COPYING)**

---

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Made with â¤ï¸  for system administrators everywhere      â•‘
â•‘                                                           â•‘
â•‘  "Think globally, execute in parallel"                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**PDSH** - *Parallel execution at scale since 1999* ğŸš€

</div>
