<div align="center">

# ğŸš€ PDSH - Parallel Distributed Shell

### *Execute commands on multiple remote hosts in parallel*

**Because life's too short to SSH into servers one by one** ğŸ¯

[![License](https://img.shields.io/badge/License-GPL-blue.svg)](COPYING)
[![C](https://img.shields.io/badge/Language-C-00599C.svg)](src/)
[![Platform](https://img.shields.io/badge/Platform-Linux%20%7C%20Unix-orange.svg)](#)
[![Build](https://img.shields.io/badge/Build-Autotools-green.svg)](#)

[Features](#-key-features) â€¢ [Installation](#-installation) â€¢ [Configuration](#%EF%B8%8F-configuration) â€¢ [Documentation](#-documentation)

</div>

---

## ğŸ“– What is PDSH?

**Pdsh** is a high-performance, multithreaded remote shell client that executes commands on multiple remote hosts **in parallel**. Whether you're managing a handful of servers or orchestrating thousands of nodes in a supercomputing cluster, pdsh scales effortlessly to meet your needs.

<div align="center">

### ğŸ¯ Key Features

</div>

<table>
<tr>
<td width="50%">

#### âš¡ Performance
- **Parallel Execution** across multiple hosts
- **Multithreaded** connection management
- Configurable fanout for optimal throughput
- Handle **thousands of nodes** simultaneously

</td>
<td width="50%">

#### ğŸ”§ Flexibility
- **Multiple protocols** (SSH, rsh, Kerberos IV, mrsh)
- **Modular design** with dynamic loading
- Extensible architecture
- Cross-platform Unix/Linux support

</td>
</tr>
<tr>
<td width="50%">

#### ğŸ›ï¸ Integration
- SLURM job scheduler support
- Genders database integration
- Nodeupdown for host availability
- GNU readline for interactive mode

</td>
<td width="50%">

#### ğŸ›¡ï¸ Reliability
- Configurable connection timeouts
- Automatic node failure handling
- Thread-safe operations
- Battle-tested in HPC environments

</td>
</tr>
</table>

### ğŸ’¡ Quick Start

```bash
# Run command on multiple hosts
pdsh -w node[1-10] uptime

# With SSH
pdsh -R ssh -w host1,host2,host3 df -h

# Use host groups
pdsh -g webservers 'systemctl status nginx'
```

### ğŸ“š Documentation

ğŸ“– **Man Pages**: See the `doc/` directory for detailed usage information
ğŸ“¦ **Modules**: Check [`README.modules`](README.modules) for available extensions
ğŸ”§ **Configuration**: Read below for build options and customization

---

## ğŸ“¦ Installation

<details open>
<summary><b>ğŸš€ Quick Install (Click to expand)</b></summary>

### Standard Build

```bash
# Configure, build, and install
./configure
make
make install
```

### ğŸ”’ SetUID Configuration (Optional)

By default, pdsh installs **without setuid permissions**. For most protocols (SSH, mrsh), root permissions aren't needed.

**However**, if you're using `rcmd/rsh` or `rcmd/qsh` modules, you'll need setuid root:

```bash
sudo chown root /usr/local/bin/pdsh /usr/local/bin/pdcp
sudo chmod 4755 /usr/local/bin/pdsh /usr/local/bin/pdcp
```

</details>

---

## âš™ï¸ Configuration

Pdsh uses **GNU autoconf** for configuration. Dynamically loadable modules for each shell service and feature are compiled based on your configuration.

> ğŸ’¡ **Default modules**: rsh, Kerberos IV, and SDR (for IBM SPs) are compiled automatically if available on your system.

### ğŸ“¦ Available Modules

For a complete description of each module, including requirements and conflicts, see the [`README.modules`](README.modules) file.

### ğŸ”§ Static Module Compilation

If your system doesn't support dynamically loadable modules, use:

```bash
./configure --enable-static-modules
```

---

## ğŸ› ï¸ Build Configuration Options

<details>
<summary><b>ğŸ” Remote Shell Services</b></summary>

<br>

| Option | Description | Status |
|--------|-------------|:------:|
| `--without-rsh` | Disable BSD rcmd(3) support (standard rsh) | Default ON |
| `--with-ssh` | Enable SSH remote shell service | âœ… Recommended |
| `--with-mrsh` | Enable mrsh(1) remote shell service | âœ… Optional |
| `--with-krb4` | Enable Kerberos IV authentication | ğŸ” Optional |

</details>

<details>
<summary><b>ğŸ—‚ï¸ Host Management</b></summary>

<br>

| Option | Description | Use Case |
|--------|-------------|----------|
| `--with-machines=/path` | Use flat file list for `-a` option | ğŸ“„ Simple setups |
| `--with-genders` | Support genders database via genders(3) library | ğŸ¢ HPC clusters |
| `--with-dshgroups` | Support dsh-style group files (`~/.dsh/group/`) | ğŸ“ Group management |
| `--with-netgroup` | Use netgroups (`/etc/netgroup` or NIS) | ğŸŒ NIS environments |

</details>

<details>
<summary><b>ğŸ® Runtime Features</b></summary>

<br>

| Option | Description | Benefit |
|--------|-------------|---------|
| `--with-nodeupdown` | Dynamic elimination of down nodes via nodeupdown(3) | âš¡ Auto-skip failures |
| `--with-slurm` | Support running under SLURM allocation | ğŸ¯ HPC integration |
| `--with-readline` | GNU readline for interactive mode | âŒ¨ï¸ Better UX |

</details>

<details>
<summary><b>âš¡ Performance Tuning</b></summary>

<br>

| Option | Default | Range | Description |
|--------|---------|-------|-------------|
| `--with-fanout=N` | **32** | 1-1024 | Set default parallel connection fanout |
| `--with-timeout=N` | **10** | 1-300 | Set default connect timeout (seconds) |

> ğŸ’¡ **Tip**: Higher fanout = faster execution, but watch out for resource exhaustion!

</details>

---

### ğŸ“ Example Configurations

<table>
<tr>
<td width="50%">

**ğŸ¢ Enterprise Setup**
```bash
./configure \
  --with-ssh \
  --with-genders \
  --with-nodeupdown \
  --with-slurm \
  --with-readline \
  --with-fanout=64 \
  --with-timeout=15
```

</td>
<td width="50%">

**âš¡ Performance Build**
```bash
./configure \
  --with-ssh \
  --with-mrsh \
  --with-dshgroups \
  --with-fanout=128 \
  --with-timeout=5 \
  --enable-static-modules
```

</td>
</tr>
</table>

### âš ï¸ Module Conflicts

> **Warning**: Some configuration options may conflict because they perform identical operations.

**Examples:**
- ğŸ”´ `genders` and `nodeattr` both support the `-g` option
- ğŸ”´ When multiple modules support the same option, one will be selected as default
- ğŸ”´ Static compilation will **fail** if conflicting modules are selected

ğŸ“– See the man page for details on which modules conflict.

---

## âš ï¸ Gotchas & Known Issues

<details>
<summary><b>1ï¸âƒ£ Reserved Socket Exhaustion</b></summary>

<br>

When using **rsh, krb4, qsh, or ssh**, pdsh uses **reserved sockets** (obtained via `rresvport()`):

| Resource | Limit | Notes |
|----------|-------|-------|
| Sockets per connection | 1-2 | Two if maintaining separate stderr |
| Total reserved port pool | **256** | System-wide limit |
| Risk factors | High fanout + multiple instances | Can exhaust pool quickly |

#### ğŸ’¡ Solutions

- âœ… **Use mrsh/mqsh** (no reserved ports required)
- âœ… **Reduce fanout** with `--with-fanout=N` or `-f N`
- âœ… **Coordinate pdsh instances** to avoid overlapping runs
- âœ… **Monitor with** `netstat -an | grep "privilege"`

</details>

<details>
<summary><b>2ï¸âƒ£ TCP Wrappers Bottlenecks</b></summary>

<br>

When using remote shell services wrapped with **TCP wrappers**, watch for performance bottlenecks:

| Service | Impact | Symptom |
|---------|--------|---------|
| ğŸ” **IDENT** | Each connection triggers IDENT query | Slow connection setup |
| ğŸŒ **DNS** | Each connection may trigger DNS lookup | High latency |
| ğŸ“ **SYSLOG** | Each connection creates syslog entry on loghost | Log server overload |

#### ğŸ’¡ Mitigation Strategies

```bash
# âœ… Configure without "PARANOID" option in hosts.allow
# âœ… Use IP addresses or subnets (avoid hostnames)
# âœ… Avoid 'user@' prefix in hosts.allow
# âœ… Set SYSLOG severity to avoid remote logging
# âœ… Reduce default fanout if bottleneck persists
```

**Example hosts.allow:**
```
# Good - Fast
sshd: 192.168.1.0/24

# Bad - Slow (triggers IDENT + DNS)
sshd: admin@.example.com : severity local0.info
```

</details>

---

## ğŸ§  Theory of Operation

<div align="center">

> **Generalized for common remote shell services (rsh, SSH, Kerberos IV, qsh, etc.)**

</div>

### ğŸ—ï¸ Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ğŸ¯ Main Thread                            â”‚
â”‚  â€¢ Spawns fanout number of worker threads                         â”‚
â”‚  â€¢ Waits on condition variable for thread completion              â”‚
â”‚  â€¢ Dynamically maintains fanout until all commands complete       â”‚
â”‚  â€¢ Collects and formats output from all threads                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â†“                       â†“                   â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ğŸ§µ Thread 1 â”‚        â”‚  ğŸ§µ Thread 2 â”‚...â”‚  ğŸ§µ Thread N â”‚
    â”‚  State: RUN  â”‚        â”‚  State: RUN  â”‚   â”‚  State: RUN  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                       â”‚                   â”‚
           â†“                       â†“                   â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ–¥ï¸  Node 1   â”‚        â”‚ ğŸ–¥ï¸  Node 2   â”‚   â”‚ ğŸ–¥ï¸  Node N   â”‚
    â”‚  SSH/RSH     â”‚        â”‚  SSH/RSH     â”‚   â”‚  SSH/RSH     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                       â”‚                   â”‚
           â†“                       â†“                   â†“
      ğŸ“¤ Output              ğŸ“¤ Output           ğŸ“¤ Output
```

### ğŸ”„ Thread Workflow

```mermaid
graph TD
    A[1ï¸âƒ£ Thread Creation] -->|Spawn worker| B[2ï¸âƒ£ Connection Setup]
    B -->|MT-safe rcmd| C[3ï¸âƒ£ I/O Streams Open]
    C -->|stdin/stderr| D[4ï¸âƒ£ Command Execution]
    D -->|Collect output| E[5ï¸âƒ£ Thread Termination]
    E -->|Signal complete| F[6ï¸âƒ£ Fanout Management]
    F -->|Start new thread| A
    F -->|All done| G[âœ… Complete]
```

<table>
<tr>
<td width="33%">

**ğŸš€ Startup**
- Main thread spawns N workers
- N = configured fanout value
- Each gets next host from queue

</td>
<td width="33%">

**âš¡ Execution**
- MT-safe connection functions
- Parallel command execution
- Independent I/O handling

</td>
<td width="33%">

**ğŸ Completion**
- Thread signals when done
- Main thread spawns replacement
- Maintains fanout until queue empty

</td>
</tr>
</table>

### â±ï¸ Timeout Management

A dedicated **timeout thread** monitors all connection threads:

| Function | Behavior |
|----------|----------|
| â° Connection timeout | Terminates threads taking too long to connect |
| â²ï¸ Command timeout | Enforces command completion timeouts (if requested) |
| ğŸ”„ Health check | Periodic polling of thread states |
| ğŸ›‘ Forced termination | Kills unresponsive threads cleanly |

### ğŸ¹ Interactive Controls

| Key Combo | Action | Details |
|-----------|--------|---------|
| **`^C`** (first press) | ğŸ“Š Status report | Lists all threads in connected state |
| **`^C`** (second press) | ğŸ›‘ Immediate exit | Terminates program and all threads immediately |
| **`^Z`** | â¸ï¸ Suspend | Pauses execution (can resume with `fg`) |

---

## ğŸ¤ Contributing & Community

<table>
<tr>
<td width="50%">

### ğŸ‘¨â€ğŸ’» Author

**Jim Garlick**
ğŸ“§ [garlick@llnl.gov](mailto:garlick@llnl.gov)

Developed at **Lawrence Livermore National Laboratory**

</td>
<td width="50%">

### ğŸ’Œ Feedback Welcome

We'd love to hear from you:
- ğŸ› **Bug reports** - Help us improve!
- ğŸ’¡ **Feature suggestions** - What do you need?
- ğŸ“Š **Usage reports** - Tell us your cluster size!
- â­ **Success stories** - Share your wins!

</td>
</tr>
</table>

### ğŸŒŸ Star History

If you find pdsh useful, please consider starring the repository! It helps others discover this tool.

---

## ğŸ“„ License & Attribution

<details>
<summary><b>View License Information</b></summary>

<br>

This product includes software developed by the **University of California, Berkeley** and its contributors.

ğŸ“ Licensed under the **GNU General Public License** - see [COPYING](COPYING) file for details.

Modifications have been made at Lawrence Livermore National Laboratory under the auspices of the U.S. Department of Energy.

### â„¹ï¸ Important Disclaimer

The **PDSH software package** has **no affiliation** with the Democratic Party of Albania ([www.pdsh.org](http://www.pdsh.org)).

We're just here to help you manage servers, not politics! ğŸ˜„

</details>

---

<div align="center">

## ğŸ“š Additional Resources

**[ğŸ“– Documentation](doc/)** â€¢ **[ğŸ“¦ Modules](README.modules)** â€¢ **[ğŸ‘¥ Contributors](AUTHORS)** â€¢ **[ğŸ“ License](COPYING)**

---

### ğŸ’¼ Use Cases

<table>
<tr>
<td align="center" width="25%">
ğŸ¢<br><b>Enterprise</b><br>
<sub>Manage thousands of servers</sub>
</td>
<td align="center" width="25%">
ğŸ”¬<br><b>HPC/Scientific</b><br>
<sub>Supercomputer clusters</sub>
</td>
<td align="center" width="25%">
â˜ï¸<br><b>Cloud/DevOps</b><br>
<sub>Infrastructure automation</sub>
</td>
<td align="center" width="25%">
ğŸ“<br><b>Academic</b><br>
<sub>Research computing</sub>
</td>
</tr>
</table>

---

### â­ Quick Stats

```
ğŸš€ Parallel execution across thousands of nodes
ğŸ§µ Multithreaded architecture for maximum performance
ğŸ”Œ Multiple protocol support (SSH, RSH, Kerberos, MRSH)
âš™ï¸ Highly configurable and extensible
ğŸ›¡ï¸ Battle-tested in production environments
```

---

<sub>Made with â¤ï¸ for system administrators, DevOps engineers, and HPC operators everywhere</sub>

**[â¬† Back to top](#-pdsh---parallel-distributed-shell)**

</div>
