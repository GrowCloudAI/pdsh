```
 ____   ____  ____  _   _
|  _ \ |  _ \/ ___|| | | |
| |_) || | | \___ \| |_| |
|  __/ | |_| |___) |  _  |
|_|    |____/|____/|_| |_|

Parallel Distributed Shell
```

<div align="center">

ğŸš€ **One Command. Many Machines. Zero Patience Required.** âš¡

</div>

---

## ğŸ“– What is PDSH?

Ever wished you could run the same command on **100 servers simultaneously** without breaking a sweat? Meet **pdsh**: your new best friend for parallel remote execution.

Think of it as the **Swiss Army knife of distributed shell commands**, minus the tiny scissors you never use.

### âœ¨ Key Features

- ğŸ¯ **Multithreaded Execution** - Commands fire off in parallel to multiple hosts
- ğŸ” **Multiple Protocols** - Choose your weapon: `rsh`, `Kerberos IV`, or `ssh`
- ğŸ’ª **High Performance** - Like having your own personal army of terminal windows that actually coordinate
- ğŸ›ï¸ **Configurable Fanout** - Control how many hosts get hit simultaneously
- ğŸŒ **Group Management** - Organize hosts with genders, dshgroups, or netgroups

> ğŸ’¡ **TL;DR**: One command, many machines, zero patience required.

ğŸ“š See the man page in the `doc/` directory for detailed usage information.

---

## âš™ï¸ Configuration

Pdsh harnesses the power of **GNU autoconf**, which means it'll figure out what works on your system like a caffeinated detective. Dynamically loadable modules for each shell service get compiled based on what you've got installed.

By default, we'll build `rsh`, `Kerberos IV`, and `SDR` support (for you lucky IBM SP owners) if the system supports them.

ğŸ“˜ The `README.modules` file contains all the juicy details about each module, including what they need and which ones don't play nice together.

### ğŸ› ï¸ Build Configuration

If your system is allergic to dynamically loadable modules, no worries! Just use `--enable-static-modules` to bake everything in statically.

```bash
./configure [options]
```

### ğŸ“‹ Configuration Options

#### ğŸ”Œ Connection Methods

| Option | Description |
|--------|-------------|
| `--without-rsh` | Disable BSD rcmd(3). Who uses rsh these days anyway? |
| `--with-ssh` | Enable ssh(1) support. Because sometimes you care about security. |
| `--with-mrsh` | Enable mrsh(1) remote shell service support. The "m" stands for "more." |
| `--with-slurm` | Support running pdsh under SLURM allocation. For when your HPC cluster needs some TLC. |

#### ğŸ—‚ï¸ Host Management

| Option | Description |
|--------|-------------|
| `--with-machines=/path` | Use a flat file of machine names for `-a` instead of that fancy genders thing. |
| `--with-genders` | Enable genders database support via the genders(3) library. For the `-i` option to work its magic, your genders database needs alternate node names in the "altname" attribute. |
| `--with-dshgroups` | Enable dsh-style group files in `~/.dsh/group/groupname` or `/etc/dsh/group/groupname`. Perfect for organizing your machines like you organize your playlists. Use `-g`/`-X` to target or exclude host groups. |
| `--with-netgroup` | Enable netgroups (via `/etc/netgroup` or NIS) for building target host lists using `-g`/`-X`. It's like speed dial, but for servers. |
| `--with-nodeupdown` | Enable dynamic elimination of down nodes through nodeupdown(3). No more shouting into the void at dead hosts! |

#### âš¡ Performance Tuning

| Option | Description |
|--------|-------------|
| `--with-fanout=N` | Specify default fanout (default: **32**). That's how many hosts get hit simultaneously. Think of it as your parallelism knob. Turn to 11? |
| `--with-timeout=N` | Set default connect timeout in seconds (default: **10**). Because ain't nobody got time for slow connections. |

#### ğŸ¨ User Experience

| Option | Description |
|--------|-------------|
| `--with-readline` | Use GNU readline for interactive mode. Arrow keys are nice, right? |

### âš ï¸ Module Conflicts

**WARNING**: Some options conflict because they do the same thing in different ways (like `genders` and `nodeattr` both claiming the `-g` option). If you try to statically compile conflicting modules, the build will politely refuse.

ğŸ“– Check the man page for the full relationship drama between modules.

---

## ğŸ”¨ Installation

```bash
make
make install
```

### ğŸ‰ Default Permissions

**Plot twist**: pdsh installs **WITHOUT setuid permissions** by default! This is because most rcmd protocols don't actually need root. Democracy wins!

### ğŸ” Old School Setup (rsh/qsh only)

However, if you're old school and using `rcmd/rsh` or `rcmd/qsh` modules, you'll need to grant pdsh and pdcp the keys to the kingdom:

```bash
chown root PREFIX/bin/pdsh PREFIX/bin/pdcp
chmod 4755 PREFIX/bin/pdsh PREFIX/bin/pdcp
```

---

## âš ï¸ Gotchas & Performance Tips

Before you blast commands to 1000 nodes, heads up on these fun surprises: ğŸ’¥

### 1ï¸âƒ£ Reserved Port Exhaustion
**Or: How I Learned to Stop Worrying and Love Mrsh**

When using `rsh`, `krb4`, `qsh`, or `ssh`, pdsh needs reserved sockets via `rresvport()` - one per connection, two if you want stderr separated.

ğŸ”¢ **The Problem**: There's a pool of **256 reserved ports**. Do the math on what happens when you fanout to 300 nodes. Spoiler: sadness.

Multiple concurrent pdsh sessions on one machine? High fanout? You'll run dry faster than a camel in the Sahara. ğŸª

âœ… **The Solution**: `mrsh` and `mqsh` don't use reserved ports, so they laugh in the face of this limitation.

### 2ï¸âƒ£ TCP Wrappers: The Triple Threat

If your remote shell service uses TCP wrappers, watch out for three bottlenecks that can ruin your day:

| Bottleneck | Problem | Impact |
|------------|---------|--------|
| ğŸ” **IDENT** | Enabled with `user@` in hosts.allow (like `in.rshd : ALL@ALL : ALLOW`) | Every connection triggers an IDENT query back to you. High fanout = IDENT server has a meltdown. |
| ğŸŒ **DNS** | TCP wrappers doing DNS lookups for each connection | Say hello to your overwhelmed DNS server. |
| ğŸ“ **SYSLOG** | Every connection logging to syslog | Hope you like gigabyte-sized logs and a very unhappy syslogd. |

#### ğŸ›¡ï¸ Mitigation Strategies

If your security policy allows, configure TCP wrappers to chill out a bit:

- âœ‚ï¸ Skip IDENT, DNS, and SYSLOG checks on remote shell connections
- ğŸ”¢ Use IP addresses or subnets instead of names
- ğŸš« Ditch the "PARANOID" option
- ğŸ“Š Set SYSLOG severity to something that doesn't scream at a remote loghost

**Can't do that?** Lower your fanout with `--with-fanout=N` during configure.

---

## ğŸ§  Theory of Operation

We'll explain using `rsh`, but this applies to all shell services (`ssh`, `krb4`, `qsh`, etc.) with some extra security sauce depending on the service.

### ğŸ”„ Thread Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Main Thread                 â”‚
â”‚  (Spawns threads up to fanout)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â–º [Thread 1] â”€â”€â–º Host 1
           â”œâ”€â”€â–º [Thread 2] â”€â”€â–º Host 2
           â”œâ”€â”€â–º [Thread N] â”€â”€â–º Host N
           â”‚
           â””â”€â”€â–º [Timeout Thread] ğŸ‘®
                (Terminates slow threads)
```

1. **Per-Connection Threading** - Each connection gets its own thread (one thread per node)
2. **MT-Safe Connections** - Each thread opens an MT-safe rcmd-like connection
3. **Stream Management** - Threads grab stdin and stderr streams, then bow out gracefully
4. **Dynamic Spawning** - Main thread waits like a patient parent. When a thread finishes, it signals a condition variable, and the main thread launches a new one
5. **Timeout Management** - A timeout thread plays hall monitor, watching for threads that take too long

### âŒ¨ï¸ Interrupt Handling

- **Press ^C once**: You'll see which threads are connected
- **Press ^C twice**: ğŸ® Game over, man

---

## ğŸ‘¨â€ğŸ’» Author

**Jim Garlick** <garlick@llnl.gov>

Got suggestions? Found a bug? ğŸ› Just want to brag about your 10,000-node cluster? ğŸ¯ Drop a line! It's always cool to hear from folks using pdsh in the wild.

---

## ğŸ“ Legal Notices

### ğŸ“œ BSD Components

This product includes software developed by the University of California, Berkeley and its contributors. We've modified it, so any bugs are definitely ours.

### ğŸ‡¦ğŸ‡± Important Disclaimer

The **PDSH software package** has **ZERO affiliation** with the Democratic Party of Albania (www.pdsh.org). Just to be crystal clear about that. ğŸ˜…

---

<div align="center">

**Made with â¤ï¸ by the HPC community**

â­ Star this repo if pdsh makes your life easier! â­

</div>
