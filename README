<div align="center">

```
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
â•šâ•â•     â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•
```

# ğŸš€ **Parallel Distributed Shell**

### *Execute commands on multiple remote hosts in parallel*

**Because life's too short to SSH into servers one by one** ğŸ¯

[![License](https://img.shields.io/badge/License-GPL-blue.svg)](COPYING)
[![C](https://img.shields.io/badge/Language-C-00599C.svg)](src/)
[![Platform](https://img.shields.io/badge/Platform-Unix%2FLinux-lightgrey.svg)]()
[![Architecture](https://img.shields.io/badge/Architecture-Multithreaded-green.svg)]()

[Features](#-key-features) â€¢ [Quick Start](#-quick-start) â€¢ [Configuration](#ï¸-configuration) â€¢ [Installation](#-installation) â€¢ [Documentation](#-documentation)

</div>

---

## ğŸ“– What is PDSH?

**Pdsh** is a high-performance, multithreaded remote shell client that executes commands on multiple remote hosts **in parallel**. Scale your operations from a handful to thousands of nodes with ease.

<details>
<summary><b>ğŸ¬ See it in action</b></summary>

```bash
# Run on multiple hosts simultaneously
$ pdsh -w server[01-10] uptime

server01: 14:23:45 up 42 days, 3:14, 2 users, load average: 0.12, 0.15, 0.09
server02: 14:23:45 up 35 days, 1:23, 1 user,  load average: 0.45, 0.38, 0.31
server03: 14:23:45 up 28 days, 7:42, 3 users, load average: 0.08, 0.12, 0.10
...
```

</details>

### ğŸ¯ Key Features

<table>
<tr>
<td width="50%">

#### âš¡ **Performance**
- ğŸ”€ **Parallel Execution** - Run commands across multiple hosts simultaneously
- ğŸ§µ **Multithreaded** - Efficient connection management with configurable fanout
- ğŸš€ **High Performance** - Handle large clusters with thousands of nodes

</td>
<td width="50%">

#### ğŸ”§ **Flexibility**
- ğŸ”Œ **Multiple Protocols** - Support for rsh, Kerberos IV, SSH, and more
- ğŸ›ï¸ **Modular Design** - Dynamically loadable modules for different services
- âš™ï¸ **Configurable** - Tune timeout, fanout, and behavior to your needs

</td>
</tr>
</table>

---

## ğŸš€ Quick Start

```bash
# 1. Configure with your preferred options
./configure --with-ssh --with-readline

# 2. Build and install
make && make install

# 3. Run a command on multiple hosts
pdsh -w host[1-10] 'hostname && uptime'

# 4. Use with SSH
pdsh -R ssh -w user@host[1-5] 'df -h'
```

> ğŸ’¡ **Tip:** Check out the [man page](doc/pdsh.1.in) for complete usage examples!

---

## âš™ï¸ Configuration

<div align="center">

**Pdsh uses GNU autoconf for configuration**
*Dynamically loadable modules for each shell service and feature are compiled based on your configuration*

</div>

> ğŸ“Œ **Default modules**: rsh, Kerberos IV, and SDR (for IBM SPs) are compiled automatically if available on your system.

### ğŸ“¦ Available Modules

<blockquote>
ğŸ“š For a complete description of each module, including requirements and conflicts, see the <a href="README.modules"><code>README.modules</code></a> file.
</blockquote>

### ğŸ”§ Static Module Compilation

If your system doesn't support dynamically loadable modules, use:

```bash
./configure --enable-static-modules
```

> âš ï¸ **Note:** Static compilation will fail if conflicting modules are selected.

---

---

## ğŸ› ï¸ Build Configuration Options

<div align="center">

**ğŸ¨ Customize PDSH to fit your infrastructure needs**

</div>

Configure pdsh with additional features using these options:

<details open>
<summary><h3>ğŸ” Remote Shell Services</h3></summary>

| Option | Description |
|--------|-------------|
| `--without-rsh` | âŒ Disable BSD rcmd(3) support (standard rsh) |
| `--with-ssh` | âœ… Enable SSH remote shell service |
| `--with-mrsh` | âœ… Enable mrsh(1) remote shell service |

</details>

<details open>
<summary><h3>ğŸ—‚ï¸ Host Management</h3></summary>

| Option | Description |
|--------|-------------|
| `--with-machines=/path/to/machines` | ğŸ“‹ Use flat file list for `-a` option |
| `--with-genders` | âœ… Support genders database via genders(3) library |
| `--with-dshgroups` | âœ… Support dsh-style group files (`~/.dsh/group/`) |
| `--with-netgroup` | âœ… Use netgroups (`/etc/netgroup` or NIS) |

</details>

<details open>
<summary><h3>ğŸ® Runtime Features</h3></summary>

| Option | Description |
|--------|-------------|
| `--with-nodeupdown` | âœ… Dynamic elimination of down nodes via nodeupdown(3) |
| `--with-slurm` | âœ… Support running under SLURM allocation |
| `--with-readline` | âœ… GNU readline for interactive mode |

</details>

<details open>
<summary><h3>âš¡ Performance Tuning</h3></summary>

| Option | Default | Description |
|--------|---------|-------------|
| `--with-fanout=N` | `32` | ğŸ”€ Set default parallel connection fanout |
| `--with-timeout=N` | `10` | â±ï¸ Set default connect timeout (seconds) |

</details>

### ğŸ“ Example Configuration

<details>
<summary><b>ğŸ’¡ Recommended configuration for modern clusters</b></summary>

```bash
./configure \
  --with-ssh \
  --with-genders \
  --with-slurm \
  --with-readline \
  --with-fanout=64 \
  --with-timeout=15
```

This configuration provides:
- âœ… SSH support for secure connections
- âœ… Genders database integration
- âœ… SLURM workload manager support
- âœ… Interactive mode with GNU readline
- âœ… Increased fanout for larger clusters
- âœ… Extended timeout for slower networks

</details>

<details>
<summary><h3>âš ï¸ Module Conflicts</h3></summary>

Some configuration options may conflict because they perform identical operations:

```
âš ï¸  genders + nodeattr â†’ Both support the `-g` option
âš ï¸  Multiple modules â†’ One will be selected as default
âš ï¸  Static compilation â†’ Will FAIL if conflicting modules are selected
```

ğŸ“– **See the man page for details on which modules conflict.**

</details>

---

## ğŸ“¦ Installation

<div align="center">

### ğŸ”¨ Build from Source

</div>

```bash
# Standard installation
make && make install
```

<details>
<summary><b>ğŸ“ Custom installation prefix</b></summary>

```bash
./configure --prefix=/usr/local/pdsh
make && make install
```

</details>

<details>
<summary><h3>ğŸ”’ SetUID Configuration (Optional)</h3></summary>

By default, pdsh installs **without setuid permissions**. For most protocols, root permissions aren't needed.

> âš ï¸ **Security Note:** Only required for `rcmd/rsh` or `rcmd/qsh` modules

If you need setuid root:

```bash
chown root PREFIX/bin/pdsh PREFIX/bin/pdcp
chmod 4755 PREFIX/bin/pdsh PREFIX/bin/pdcp
```

</details>

---

## âš ï¸ Gotchas & Known Issues

<div align="center">

**ğŸ“š Important information for production deployments**

</div>

<details>
<summary><h3>1ï¸âƒ£ Reserved Socket Exhaustion</h3></summary>

When using rsh, krb4, qsh, or ssh, pdsh uses **reserved sockets** (obtained via `rresvport()`):

```
ğŸ“Š Socket Usage:
   â€¢ One socket per active connection
   â€¢ Two sockets if maintaining separate stderr
   â€¢ Total pool: 256 sockets
```

**Can be exhausted by:**
- ğŸ”„ Multiple pdsh instances running simultaneously
- ğŸ“ˆ Very high fanout settings

<blockquote>
ğŸ’¡ <b>Solution:</b> Use mrsh/mqsh (no reserved ports) or reduce fanout with <code>--with-fanout=N</code>
</blockquote>

</details>

<details>
<summary><h3>2ï¸âƒ£ TCP Wrappers Bottlenecks</h3></summary>

When using remote shell services wrapped with TCP wrappers, watch for bottlenecks:

| Service | Impact | Performance Hit |
|---------|--------|----------------|
| **IDENT** | With `user@` in hosts.allow, each connection triggers IDENT query | ğŸ”´ High |
| **DNS** | Each connection may trigger DNS lookup | ğŸŸ¡ Medium |
| **SYSLOG** | Each connection creates syslog entry on loghost | ğŸŸ¡ Medium |

<blockquote>
ğŸ’¡ <b>Mitigation strategies:</b>
<ul>
<li>âœ… Configure without "PARANOID" option</li>
<li>âœ… Use IP addresses or subnets (avoid names and <code>user@</code> prefix)</li>
<li>âœ… Set SYSLOG severity to avoid remote logging</li>
<li>âœ… Reduce default fanout if needed</li>
</ul>
</blockquote>

</details>

---

## ğŸ§  Theory of Operation

<div align="center">

**Understanding PDSH's Multithreaded Architecture**

*Generalized for the common remote shell service (rsh). Similar for SSH, Kerberos IV, qsh, etc.*

</div>

### Architecture

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         Main Thread                           â•‘
â•‘  â€¢ Starts fanout number of rsh threads                        â•‘
â•‘  â€¢ Waits on condition variable                                â•‘
â•‘  â€¢ Maintains fanout until all commands complete               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                               â†“
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â†“                   â†“                   â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Thread  â”‚         â”‚ Thread  â”‚   ...   â”‚ Thread  â”‚
      â”‚    1    â”‚         â”‚    2    â”‚         â”‚    N    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                   â”‚                   â”‚
           â†“                   â†“                   â†“
      [Node 1]            [Node 2]            [Node N]
```

### ğŸ”„ Thread Workflow

```mermaid
graph LR
    A[Thread Creation] --> B[Connection]
    B --> C[I/O Streams]
    C --> D[Termination]
    D --> E[Fanout Management]
    E --> A
```

1. **ğŸ¯ Thread Creation** - One thread per remote connection
2. **ğŸ”Œ Connection** - MT-safe rcmd-like function opens connection
3. **ğŸ“¡ I/O Streams** - Returns stdin and stderr streams
4. **âœ… Termination** - Thread signals completion and terminates
5. **ğŸ”„ Fanout Management** - Main thread starts new threads to maintain fanout

### â±ï¸ Timeout Management

A dedicated **timeout thread** monitors all connection threads:

<table>
<tr>
<td width="50%">

#### ğŸ” **Connection Monitoring**
Terminates threads taking too long to connect

</td>
<td width="50%">

#### âš¡ **Command Enforcement**
Enforces command completion timeouts (if requested)

</td>
</tr>
</table>

### ğŸ¹ Interactive Controls

<table>
<thead>
<tr>
<th>Key Combo</th>
<th>Action</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><kbd>Ctrl</kbd> + <kbd>C</kbd> (first)</td>
<td>ğŸ“‹ List threads in connected state</td>
<td>Debug stuck connections</td>
</tr>
<tr>
<td><kbd>Ctrl</kbd> + <kbd>C</kbd> (second)</td>
<td>ğŸ›‘ Terminate program immediately</td>
<td>Emergency stop</td>
</tr>
</tbody>
</table>

---

## ğŸ‘¨â€ğŸ’» Author & Contributors

<div align="center">

**Jim Garlick** - [garlick@llnl.gov](mailto:garlick@llnl.gov)

### ğŸ’Œ Feedback Welcome!

<table>
<tr>
<td align="center">ğŸ›<br><b>Bug Reports</b></td>
<td align="center">ğŸ’¡<br><b>Suggestions</b></td>
<td align="center">ğŸ“Š<br><b>Usage Reports</b></td>
</tr>
<tr>
<td align="center" colspan="3">
<i>We'd love to hear about your cluster size!</i>
</td>
</tr>
</table>

</div>

---

## ğŸ“„ License & Attribution

<details>
<summary><b>View License Information</b></summary>

<br>

This product includes software developed by the **University of California, Berkeley** and its contributors.

> Modifications have been made and bugs are probably mine. - *Jim Garlick*

### â„¹ï¸ Important Disclaimer

The PDSH software package has **no affiliation** with the Democratic Party of Albania ([www.pdsh.org](http://www.pdsh.org)).

ğŸ“œ See [COPYING](COPYING) for full license details.

</details>

---

<div align="center">

## ğŸ“š Documentation

**[ğŸ“– Man Pages](doc/)** â€¢ **[ğŸ”Œ Modules](README.modules)** â€¢ **[ğŸ‘¥ Contributors](AUTHORS)** â€¢ **[ğŸ“„ License](COPYING)**

---

### ğŸŒŸ Star this project if you find it useful!

<sub>Made with â¤ï¸ for system administrators everywhere</sub>

<br>

```
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
â•šâ•â•     â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•
```

**Parallel Distributed Shell** - *Execute commands on thousands of nodes in parallel*

</div>
