+-------------+
| üìñ Description |
+-------------+
Ever wished you could run the same command on 100 servers simultaneously
without breaking a sweat? Meet pdsh: your new best friend for parallel
remote execution. üöÄ Think of it as the Swiss Army knife of distributed shell
commands, minus the tiny scissors you never use.

Pdsh is a multithreaded remote shell client that fires off commands to
multiple hosts in parallel. üí™ It's like having your own personal army of
terminal windows, except they actually coordinate. Choose your weapon:
classic rsh, Kerberos IV, or everyone's favorite, ssh.

‚ö° TL;DR: One command, many machines, zero patience required.

See the man page in the doc directory for usage information (yes, we
actually wrote one).

+---------------+
| ‚öôÔ∏è Configuration |
+---------------+

Pdsh harnesses the power of GNU autoconf, which means it'll figure out
what works on your system like a caffeinated detective. Dynamically
loadable modules for each shell service get compiled based on what you've
got installed. By default, we'll build rsh, Kerberos IV, and SDR support
(for you lucky IBM SP owners) if the system supports them.

The README.modules file contains all the juicy details about each module,
including what they need and which ones don't play nice together (like
cats at a vet's office).

If your system is allergic to dynamically loadable modules, no worries!
Just use --enable-static-modules to bake everything in statically.

To configure with your preferred modules:

./configure [options]

--without-rsh
	Disable BSD rcmd(3). Who uses rsh these days anyway? (Don't answer that.)

--with-ssh
        Enable ssh(1) support. Because sometimes you care about security.

--with-machines=/path/to/machines
	Use a flat file of machine names for -a instead of that fancy genders thing.

--with-genders
        Enable genders database support via the genders(3) library. For the
        -i option to work its magic, your genders database needs alternate
        node names in the "altname" attribute. No, we won't judge your
        naming scheme.

--with-dshgroups
		Enable dsh-style group files in ~/.dsh/group/groupname or
		/etc/dsh/group/groupname. Perfect for organizing your machines
		like you organize your playlists. Use -g/-X to target or exclude
		host groups.

--with-netgroup
		Enable netgroups (via /etc/netgroup or NIS) for building target host
		lists using -g/-X. It's like speed dial, but for servers.

--with-nodeupdown
        Enable dynamic elimination of down nodes through nodeupdown(3).
        No more shouting into the void at dead hosts!

--with-mrsh
        Enable mrsh(1) remote shell service support. The "m" stands for "more."

--with-slurm
	Support running pdsh under SLURM allocation. For when your HPC cluster
	needs some TLC.

--with-fanout=N
	Specify default fanout (default is 32). That's how many hosts get hit
	simultaneously. Think of it as your parallelism knob. Turn to 11?

--with-timeout=N
	Set default connect timeout in seconds (default is 10). Because ain't
	nobody got time for slow connections.

--with-readline
	Use GNU readline for interactive mode. Arrow keys are nice, right?

WARNING: Some options conflict because they do the same thing in different
ways (like genders and nodeattr both claiming the -g option). If you try to
statically compile conflicting modules, the build will politely refuse.
Check the man page for the full relationship drama between modules.

+------------+
| üî® INSTALLING |
+------------+
make
make install

üéâ Plot twist: pdsh installs WITHOUT setuid permissions by default! This is
because most rcmd protocols don't actually need root. Democracy wins!

However, if you're old school and using "rcmd/rsh" or "rcmd/qsh" modules,
you'll need to grant pdsh and pdcp the keys to the kingdom:

 > chown root PREFIX/bin/pdsh PREFIX/bin/pdcp
 > chmod 4755 PREFIX/bin/pdsh PREFIX/bin/pdcp

+---------+
| ‚ö†Ô∏è GOTCHAS |
+---------+

Before you blast commands to 1000 nodes, heads up on these fun surprises: üí•

1) RESERVED PORT EXHAUSTION (or: How I Learned to Stop Worrying and Love Mrsh)

When using rsh, krb4, qsh, or ssh, pdsh needs reserved sockets via
rresvport() - one per connection, two if you want stderr separated. There's
a pool of 256 reserved ports. Do the math on what happens when you fanout
to 300 nodes. Spoiler: sadness.

Multiple concurrent pdsh sessions on one machine? High fanout? You'll run
dry faster than a camel in the Sahara.

‚úÖ Good news: mrsh and mqsh don't use reserved ports, so they laugh in the
face of this limitation.

2) TCP WRAPPERS: THE TRIPLE THREAT

If your remote shell service uses TCP wrappers, watch out for three
bottlenecks that can ruin your day: IDENT, DNS, and SYSLOG.

- If hosts.allow has "user@" (like "in.rshd : ALL@ALL : ALLOW") and IDENT
  is enabled, every connection triggers an IDENT query back to you. High
  fanout = IDENT server has a meltdown.

- TCP wrappers doing DNS lookups for each connection? Say hello to your
  overwhelmed DNS server.

- Every connection logging to syslog? Hope you like gigabyte-sized logs
  and a very unhappy syslogd.

If your security policy allows, configure TCP wrappers to chill out a bit:
skip IDENT, DNS, and SYSLOG checks on remote shell connections. Use IP
addresses or subnets instead of names, ditch the "PARANOID" option, and
set SYSLOG severity to something that doesn't scream at a remote loghost.
Can't do that? Lower your fanout with --with-fanout=N during configure.

+---------------------+
| üß† THEORY OF OPERATION |
+---------------------+
We'll explain using rsh, but this applies to all shell services (ssh, krb4,
qsh, etc.) with some extra security sauce depending on the service.

Each connection gets its own thread (one thread per node). The thread opens
an MT-safe rcmd-like connection, grabs stdin and stderr streams, then bows
out gracefully.

The main thread spawns threads up to the fanout limit, then waits around
like a patient parent. When a thread finishes, it signals a condition
variable, and the main thread launches a new one to keep the parallelism
party going. Rinse and repeat until all commands are done.

A timeout thread plays hall monitor, watching for threads that take too
long connecting (or running, if you asked for that). Slow pokes get
terminated.

Pressed ^C once? You'll see which threads are connected. Press ^C again
immediately? üéÆ Game over, man.

+--------+
| üë®‚Äçüíª AUTHOR |
+--------+
Jim Garlick <garlick@llnl.gov>

Got suggestions? Found a bug? üêõ Just want to brag about your 10,000-node
cluster? üéØ Drop a line! It's always cool to hear from folks using pdsh in
the wild.

+------+
| üìù NOTE |
+------+
This product includes software developed by the University of California,
Berkeley and its contributors. We've modified it, so any bugs are
definitely ours.

Also: The PDSH software package has ZERO affiliation with the Democratic
Party of Albania (www.pdsh.org). Just to be crystal clear about that.
