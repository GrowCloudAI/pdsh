<div align="center">

# ğŸš€ PDSH - Parallel Distributed Shell

### *Execute commands on multiple remote hosts in parallel*

**Because life's too short to SSH into servers one by one** ğŸ–¥ï¸ âš¡ ğŸ–¥ï¸

[![License](https://img.shields.io/badge/License-GPL-blue.svg)](COPYING)
[![Language](https://img.shields.io/badge/Language-C-00599C.svg)](src/)
[![Platform](https://img.shields.io/badge/Platform-Linux%20%7C%20Unix-lightgrey.svg)](#)
[![Build](https://img.shields.io/badge/Build-Autotools-success.svg)](#)

[Features](#-key-features) â€¢ [Installation](#-installation) â€¢ [Configuration](#ï¸-configuration) â€¢ [Documentation](#-documentation) â€¢ [Contributing](#-feedback-welcome)

</div>

---

## ğŸ“– What is PDSH?

**Pdsh** is a high-performance, multithreaded remote shell client that executes commands on multiple remote hosts **in parallel**. Perfect for managing clusters, deploying updates, or gathering logs from hundreds or thousands of servers simultaneously.

<div align="center">

### ğŸ’ª Scale from 10 nodes to 10,000 nodes with ease

</div>

## ğŸ¯ Key Features

<table>
<tr>
<td width="50%">

### âš¡ **Performance**
- ğŸ”€ **Parallel Execution** - Run commands across multiple hosts simultaneously
- ğŸ§µ **Multithreaded Architecture** - Efficient connection management
- ğŸš„ **Configurable Fanout** - Control concurrency (default: 32 threads)
- ğŸ“ˆ **Scalable** - Handle clusters with thousands of nodes

</td>
<td width="50%">

### ğŸ”§ **Flexibility**
- ğŸ”Œ **Multiple Protocols** - SSH, RSH, Kerberos IV, MRSH
- ğŸ›ï¸ **Modular Design** - Dynamically loadable service modules
- ğŸ—‚ï¸ **Smart Host Selection** - Genders, netgroups, dshgroups, SLURM
- âŒ¨ï¸ **Interactive Mode** - Optional GNU readline support

</td>
</tr>
</table>

## ğŸš€ Quick Start

```bash
# Execute 'uptime' on multiple hosts
pdsh -w node[1-100] uptime

# Run command on hosts from a file
pdsh -w ^hostfile.txt 'df -h'

# Use SSH protocol with specific fanout
pdsh -R ssh -f 64 -w server[01-32] 'systemctl status nginx'

# Interactive mode - enter commands one at a time
pdsh -w cluster[1-10]
```

## ğŸ“š Documentation

ğŸ“– **Detailed usage information** - See the comprehensive man pages in the `doc/` directory

ğŸ“˜ **Module details** - Check [`README.modules`](README.modules) for all available modules

---

## ğŸ“¦ Installation

### Step 1ï¸âƒ£: Configure

Pdsh uses **GNU autoconf** for configuration. Customize your build with the options below:

```bash
./configure [OPTIONS]
```

> ğŸ’¡ **Default modules**: RSH, Kerberos IV, and SDR (for IBM SPs) are compiled automatically if available on your system.

### Step 2ï¸âƒ£: Build & Install

```bash
make
make install
```

### ğŸ”’ SetUID Configuration (Optional)

By default, pdsh installs **without setuid permissions**. For most protocols (SSH, MRSH), root permissions aren't needed.

**However**, if you're using `rcmd/rsh` or `rcmd/qsh` modules, you'll need setuid root:

```bash
chown root PREFIX/bin/pdsh PREFIX/bin/pdcp
chmod 4755 PREFIX/bin/pdsh PREFIX/bin/pdcp
```

### ğŸ”§ Static Module Compilation

If your system doesn't support dynamically loadable modules, use:

```bash
./configure --enable-static-modules
```

---

## âš™ï¸ Build Configuration Options

<div align="center">

**ğŸ¨ Customize your PDSH build with powerful configuration options**

</div>

Configure pdsh with additional features and modules:

### ğŸ” Remote Shell Services

| Option | Description |
|--------|-------------|
| `--without-rsh` | Disable BSD rcmd(3) support (standard rsh) |
| `--with-ssh` | âœ… Enable SSH remote shell service |
| `--with-mrsh` | âœ… Enable mrsh(1) remote shell service |

### ğŸ—‚ï¸ Host Management

| Option | Description |
|--------|-------------|
| `--with-machines=/path/to/machines` | Use flat file list for `-a` option |
| `--with-genders` | âœ… Support genders database via genders(3) library |
| `--with-dshgroups` | âœ… Support dsh-style group files (`~/.dsh/group/`) |
| `--with-netgroup` | âœ… Use netgroups (`/etc/netgroup` or NIS) |

### ğŸ® Runtime Features

| Option | Description |
|--------|-------------|
| `--with-nodeupdown` | âœ… Dynamic elimination of down nodes via nodeupdown(3) |
| `--with-slurm` | âœ… Support running under SLURM allocation |
| `--with-readline` | âœ… GNU readline for interactive mode |

### âš¡ Performance Tuning

| Option | Default | Description |
|--------|---------|-------------|
| `--with-fanout=N` | 32 | Set default parallel connection fanout |
| `--with-timeout=N` | 10 | Set default connect timeout (seconds) |

### ğŸ“ Example Configurations

<details>
<summary><b>ğŸ¢ Enterprise Cluster Setup</b> (SSH + SLURM + Genders)</summary>

```bash
./configure \
  --with-ssh \
  --with-genders \
  --with-slurm \
  --with-readline \
  --with-fanout=64 \
  --with-timeout=15
```
</details>

<details>
<summary><b>ğŸ”’ High-Security Environment</b> (SSH + Kerberos)</summary>

```bash
./configure \
  --with-ssh \
  --without-rsh \
  --with-readline \
  --with-fanout=32 \
  --with-timeout=20
```
</details>

<details>
<summary><b>âš¡ Maximum Performance</b> (MRSH + High Fanout)</summary>

```bash
./configure \
  --with-mrsh \
  --with-machines=/etc/pdsh/machines \
  --with-fanout=128 \
  --with-timeout=5
```
</details>

### âš ï¸ Module Conflicts

> **âš¡ Important:** Some configuration options may conflict because they perform identical operations.

**Common conflicts:**
- `genders` and `nodeattr` both support the `-g` option
- When multiple modules support the same option, one will be selected as default
- Static compilation will **fail** if conflicting modules are selected

ğŸ“– See the man page or [`README.modules`](README.modules) for details on which modules conflict.

---

## âš ï¸ Gotchas & Known Issues

### 1ï¸âƒ£ Reserved Socket Exhaustion

<table>
<tr>
<td width="60%">

**The Problem:**
When using rsh, krb4, qsh, or ssh, pdsh uses **reserved sockets** (via `rresvport()`):
- One socket per active connection (two if maintaining separate stderr)
- Pool of only **256 sockets** available
- Can be exhausted with multiple pdsh instances or very high fanout

</td>
<td width="40%">

**ğŸ’¡ Solutions:**
- âœ… Use **mrsh/mqsh** (no reserved ports needed)
- âœ… Reduce fanout: `--with-fanout=N`
- âœ… Stagger multiple pdsh runs
- âœ… Use SSH without separate stderr

</td>
</tr>
</table>

### 2ï¸âƒ£ TCP Wrappers Bottlenecks

When using remote shell services wrapped with TCP wrappers, watch for performance bottlenecks:

<table>
<tr>
<th width="20%">Service</th>
<th width="40%">Impact</th>
<th width="40%">Mitigation</th>
</tr>
<tr>
<td><b>IDENT</b></td>
<td>With <code>user@</code> in hosts.allow, each connection triggers IDENT query</td>
<td>âŒ Don't use <code>user@</code> prefix in hosts.allow</td>
</tr>
<tr>
<td><b>DNS</b></td>
<td>Each connection may trigger reverse DNS lookup</td>
<td>âœ… Use IP addresses or configure without "PARANOID"</td>
</tr>
<tr>
<td><b>SYSLOG</b></td>
<td>Each connection creates syslog entry on loghost</td>
<td>âœ… Set SYSLOG severity to avoid remote logging</td>
</tr>
</table>

**ğŸ¯ Best Practices:**
- Configure without "PARANOID" option in TCP wrappers
- Use IP addresses or subnets instead of hostnames
- Reduce default fanout if bottlenecks occur
- Consider using MRSH which avoids TCP wrappers entirely

---

## ğŸ§  Theory of Operation

<div align="center">

**Understanding PDSH's multithreaded architecture**

*Generalized for common remote shell services (RSH, SSH, Kerberos IV, QSH, etc.)*

</div>

### ğŸ—ï¸ Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ¯ Main Thread                           â”‚
â”‚                                                             â”‚
â”‚  âœ“ Starts fanout number of worker threads                  â”‚
â”‚  âœ“ Waits on condition variable                             â”‚
â”‚  âœ“ Maintains fanout until all commands complete            â”‚
â”‚  âœ“ Collects and formats output                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                   â†“                   â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ğŸ§µ Workerâ”‚         â”‚ ğŸ§µ Workerâ”‚   ...   â”‚ ğŸ§µ Workerâ”‚
   â”‚ Thread 1â”‚         â”‚ Thread 2â”‚         â”‚ Thread Nâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚                   â”‚
        â†“                   â†“                   â†“
   ğŸ–¥ï¸ Node 1          ğŸ–¥ï¸ Node 2          ğŸ–¥ï¸ Node N
```

### ğŸ”„ Thread Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1ï¸âƒ£ CREATE  â”‚  Thread spawned from pool
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2ï¸âƒ£ CONNECT â”‚  MT-safe rcmd() opens remote connection
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3ï¸âƒ£ EXECUTE â”‚  Send command, manage stdin/stdout/stderr
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4ï¸âƒ£ COMPLETE â”‚  Signal main thread, return result
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5ï¸âƒ£ RECYCLE â”‚  Main thread spawns new worker (maintains fanout)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### â±ï¸ Timeout Management

A dedicated **timeout thread** ğŸ• monitors all connection threads:
- â° Terminates threads taking too long to connect
- ğŸ›‘ Enforces command completion timeouts (if requested)
- ğŸ“Š Maintains health status of all active connections

### ğŸ¹ Interactive Controls

<table>
<tr>
<th>Key Combo</th>
<th>Action</th>
<th>Use Case</th>
</tr>
<tr>
<td><kbd>Ctrl</kbd> + <kbd>C</kbd> (first press)</td>
<td>ğŸ“‹ List threads in connected state</td>
<td>Check progress without terminating</td>
</tr>
<tr>
<td><kbd>Ctrl</kbd> + <kbd>C</kbd> (second press)</td>
<td>ğŸ›‘ Terminate program immediately</td>
<td>Emergency stop</td>
</tr>
<tr>
<td><kbd>Ctrl</kbd> + <kbd>Z</kbd></td>
<td>â¸ï¸ Suspend to background</td>
<td>Pause execution (resume with <code>fg</code>)</td>
</tr>
</table>

---

## ğŸ“ Use Cases

<table>
<tr>
<td width="50%">

### ğŸ¢ **System Administration**
```bash
# Check disk space across cluster
pdsh -w node[1-100] 'df -h /'

# Restart service on multiple servers
pdsh -w web[1-20] 'systemctl restart nginx'

# Collect logs from all nodes
pdsh -w cluster[1-50] 'tail -n 100 /var/log/app.log'
```

</td>
<td width="50%">

### ğŸ”¬ **HPC & Research**
```bash
# Check job status on compute nodes
pdsh -w compute[01-64] 'squeue -u $USER'

# Monitor GPU utilization
pdsh -w gpu[1-8] 'nvidia-smi --query-gpu=utilization.gpu --format=csv'

# Sync data to all nodes
pdsh -w cluster[1-100] 'rsync -av /data/ /local/data/'
```

</td>
</tr>
<tr>
<td width="50%">

### ğŸš€ **DevOps & Deployment**
```bash
# Deploy configuration changes
pdsh -w prod[1-32] 'sudo cp /tmp/config.yml /etc/app/'

# Check service health
pdsh -w backend[1-16] 'curl -s localhost:8080/health'

# Rolling updates
pdsh -w app[1-4] 'sudo systemctl stop app && sudo yum update -y app'
```

</td>
<td width="50%">

### ğŸ“Š **Monitoring & Diagnostics**
```bash
# Check system load
pdsh -w all 'uptime'

# Network connectivity test
pdsh -w node[1-100] 'ping -c 1 8.8.8.8'

# Find which nodes have a process running
pdsh -w cluster[1-200] 'pgrep -l java'
```

</td>
</tr>
</table>

---

## ğŸ‘¨â€ğŸ’» Author & Contributors

<table>
<tr>
<td align="center" width="200px">
<img src="https://github.com/chaos.png" width="100px" alt="Author"/>
<br />
<b>Jim Garlick</b>
<br />
<a href="mailto:garlick@llnl.gov">ğŸ“§ Contact</a>
<br />
<sub>Original Author</sub>
</td>
<td width="600px">

### ğŸ’Œ Feedback & Contributions Welcome!

We'd love to hear from you:

- ğŸ› **Bug Reports** - Found an issue? Let us know!
- ğŸ’¡ **Feature Suggestions** - Have an idea? We're listening!
- ğŸ“Š **Usage Reports** - Tell us about your cluster! (We love hearing about scale)
- ğŸ¤ **Code Contributions** - PRs welcome!
- â­ **Star this repo** - If PDSH helps you manage your infrastructure

</td>
</tr>
</table>

---

## ğŸ“„ License & Attribution

<div align="center">

**GPL Licensed** - See [COPYING](COPYING) for details

This product includes software developed by the **University of California, Berkeley** and its contributors.

</div>

### â„¹ï¸ Fun Fact

The PDSH software package has **no affiliation** with the Democratic Party of Albania ([www.pdsh.org](http://www.pdsh.org)) ğŸ‡¦ğŸ‡±

We're all about parallel shells, not parallel politics! ğŸ˜„

---

<div align="center">

## ğŸ“š Additional Resources

**[ğŸ“– Documentation](doc/)** â€¢ **[ğŸ”Œ Modules](README.modules)** â€¢ **[ğŸ‘¥ Contributors](AUTHORS)** â€¢ **[ğŸ“ Install Guide](INSTALL)**

---

### â­ If PDSH makes your life easier, consider starring this repo!

**Made with â¤ï¸ for system administrators everywhere**

*Managing one server at a time is so 1990s* ğŸš€

---

![Parallel](https://img.shields.io/badge/Execute-In%20Parallel-success?style=for-the-badge)
![Scale](https://img.shields.io/badge/Scale-Thousands%20of%20Nodes-blue?style=for-the-badge)
![Fast](https://img.shields.io/badge/Speed-Multithreaded-orange?style=for-the-badge)

</div>
