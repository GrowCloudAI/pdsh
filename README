<div align="center">

```
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
â•šâ•â•     â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•
```

# ğŸš€ Parallel Distributed Shell

### *Execute commands on multiple remote hosts in parallel*
**Because life's too short to SSH into servers one by one.**

[![License](https://img.shields.io/badge/License-GPL-blue.svg)](COPYING)
[![Language](https://img.shields.io/badge/Language-C-00599C.svg)](src/)
[![Platform](https://img.shields.io/badge/Platform-Linux%20%7C%20Unix-lightgrey.svg)](#)

[Features](#-features) â€¢ [Quick Start](#-quick-start) â€¢ [Installation](#-installation) â€¢ [Configuration](#%EF%B8%8F-configuration) â€¢ [Documentation](#-documentation)

</div>

---

## âœ¨ Features

<table>
<tr>
<td width="50%">

### âš¡ **Lightning Fast**
Execute commands across thousands of nodes simultaneously with intelligent parallel processing

### ğŸ”Œ **Multi-Protocol**
Built-in support for SSH, RSH, Kerberos IV, MRSH, and more

</td>
<td width="50%">

### ğŸ§µ **Multithreaded**
Efficient connection management with configurable fanout settings

### ğŸ›ï¸ **Highly Modular**
Dynamically loadable modules - use only what you need

</td>
</tr>
</table>

---

## ğŸš€ Quick Start

### Basic Usage

```bash
# Execute command on multiple hosts
pdsh -w host[1-10] uptime

# Use SSH and gather output
pdsh -w node[01-99] -R ssh "df -h"

# Read hosts from file
pdsh -w ^hostlist.txt "free -m"

# Interactive mode
pdsh -w cluster[1-8] -i
```

### ğŸ“Š Example Output

```
node1: Filesystem      Size  Used Avail Use% Mounted on
node2: Filesystem      Size  Used Avail Use% Mounted on
node3: Filesystem      Size  Used Avail Use% Mounted on
...
```

### ğŸ¯ Common Use Cases

| Task | Command |
|------|---------|
| ğŸ” **Check system load** | `pdsh -w node[1-20] uptime` |
| ğŸ“¦ **Deploy updates** | `pdsh -w @all "apt-get update && apt-get upgrade -y"` |
| ğŸ”„ **Restart services** | `pdsh -w cluster[1-50] "systemctl restart nginx"` |
| ğŸ“ **Collect logs** | `pdsh -w web[1-10] "tail /var/log/app.log"` |
| ğŸ’¾ **Disk usage check** | `pdsh -w storage[1-8] "df -h \| grep /data"` |

---

## ğŸ“¦ Installation

### Option 1: Quick Install (Default Configuration)

```bash
./configure
make
make install
```

### Option 2: Custom Build (Recommended)

```bash
# Configure with popular options
./configure \
  --with-ssh \
  --with-genders \
  --with-slurm \
  --with-readline \
  --with-fanout=64 \
  --with-timeout=15

make
sudo make install
```

### ğŸ”’ SetUID Configuration (Optional)

**Required only for rcmd/rsh or rcmd/qsh modules:**

```bash
sudo chown root /usr/local/bin/pdsh /usr/local/bin/pdcp
sudo chmod 4755 /usr/local/bin/pdsh /usr/local/bin/pdcp
```

> âš ï¸ **Note**: Most modern setups use SSH and don't need setuid permissions.

---

## âš™ï¸ Configuration

### ğŸ›ï¸ Build Configuration Options

<details>
<summary><strong>ğŸ” Remote Shell Services</strong> (Click to expand)</summary>

| Option | Description |
|--------|-------------|
| `--without-rsh` | Disable BSD rcmd(3) support (standard rsh) |
| `--with-ssh` | âœ… Enable SSH remote shell service |
| `--with-mrsh` | âœ… Enable mrsh(1) remote shell service |
| `--with-exec` | âœ… Execute local commands without remote shells |

</details>

<details>
<summary><strong>ğŸ—‚ï¸ Host Management</strong> (Click to expand)</summary>

| Option | Description |
|--------|-------------|
| `--with-machines=/path/to/machines` | Use flat file list for `-a` option |
| `--with-genders` | âœ… Support genders database via genders(3) library |
| `--with-dshgroups` | âœ… Support dsh-style group files (`~/.dsh/group/`) |
| `--with-netgroup` | âœ… Use netgroups (`/etc/netgroup` or NIS) |
| `--with-slurm` | âœ… Support running under SLURM allocation |

</details>

<details>
<summary><strong>ğŸ® Runtime Features</strong> (Click to expand)</summary>

| Option | Description |
|--------|-------------|
| `--with-nodeupdown` | âœ… Dynamic elimination of down nodes via nodeupdown(3) |
| `--with-readline` | âœ… GNU readline for interactive mode |
| `--with-dshbak` | âœ… Include dshbak output formatter utility |

</details>

<details>
<summary><strong>âš¡ Performance Tuning</strong> (Click to expand)</summary>

| Option | Default | Description |
|--------|---------|-------------|
| `--with-fanout=N` | 32 | Set default parallel connection fanout |
| `--with-timeout=N` | 10 | Set default connect timeout (seconds) |

> ğŸ’¡ **Tip**: For large clusters (100+ nodes), set fanout to 64-128 for optimal performance.

</details>

<details>
<summary><strong>ğŸ”§ Advanced Options</strong> (Click to expand)</summary>

```bash
# Static module compilation (for systems without dynamic loading)
./configure --enable-static-modules

# Enable debug mode
./configure --enable-debug

# Custom installation prefix
./configure --prefix=/opt/pdsh
```

</details>

### ğŸ“¦ Available Modules

> **Default modules**: rsh, Kerberos IV, and SDR (for IBM SPs) are compiled automatically if available.

For a complete description of each module, including requirements and conflicts, see **[README.modules](README.modules)**.

### âš ï¸ Module Conflicts

Some configuration options may conflict because they perform identical operations:

- `genders` and `nodeattr` both support the `-g` option
- When multiple modules support the same option, one will be selected as default
- Static compilation will **fail** if conflicting modules are selected

ğŸ“– See the man page for details on which modules conflict.

---

## ğŸ§  Architecture & Design

### System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PDSH Main Thread                         â”‚
â”‚  â€¢ Parses arguments and loads configuration                      â”‚
â”‚  â€¢ Initializes fanout number of worker threads                   â”‚
â”‚  â€¢ Maintains thread pool until all commands complete             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                      â”‚                      â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚ Worker  â”‚           â”‚ Worker  â”‚    ...    â”‚ Worker  â”‚
   â”‚ Thread 1â”‚           â”‚ Thread 2â”‚           â”‚ Thread Nâ”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
        â†“                     â†“                     â†“
   [Node 001]            [Node 002]            [Node NNN]
```

### ğŸ”„ Thread Workflow

1. **ğŸ¬ Initialization** - Main thread spawns worker threads up to fanout limit
2. **ğŸ”Œ Connection** - Each thread establishes connection using MT-safe rcmd-like function
3. **ğŸ“¡ I/O Handling** - Separate stdin/stdout/stderr streams for each connection
4. **â±ï¸ Timeout Management** - Dedicated thread monitors and enforces timeouts
5. **âœ… Completion** - Worker signals main thread and terminates
6. **ğŸ” Fanout Control** - Main thread spawns new workers to maintain configured fanout

### ğŸ¹ Interactive Controls

| Key Combo | Action |
|-----------|--------|
| `^C` (first press) | ğŸ“‹ List all threads currently in connected state |
| `^C` (second press) | â›” Terminate program immediately |
| `^Z` | ğŸ›‘ Suspend pdsh (can be resumed with `fg`) |

---

## âš ï¸ Common Pitfalls & Solutions

### 1ï¸âƒ£ Reserved Socket Exhaustion

**Problem**: When using rsh, krb4, qsh, or ssh, pdsh uses reserved sockets (via `rresvport()`):
- One socket per active connection (two if maintaining separate stderr)
- Only 256 sockets available system-wide
- Can be exhausted with multiple pdsh instances or very high fanout

**Solution**:
```bash
# Option A: Use mrsh/mqsh (no reserved ports required)
./configure --with-mrsh

# Option B: Reduce fanout setting
./configure --with-fanout=32

# Option C: Runtime fanout adjustment
pdsh -f 24 -w node[1-100] command
```

### 2ï¸âƒ£ TCP Wrappers Performance

**Problem**: TCP wrappers can create bottlenecks on large clusters:

| Service | Impact |
|---------|--------|
| **IDENT** | With `user@` in hosts.allow, each connection triggers IDENT query |
| **DNS** | Each connection may trigger reverse DNS lookup |
| **SYSLOG** | Each connection creates syslog entry (may overload loghost) |

**Solution**:
- âœ… Configure without "PARANOID" option
- âœ… Use IP addresses or subnets instead of hostnames
- âœ… Avoid `user@` prefix in hosts.allow
- âœ… Set SYSLOG severity to avoid remote logging
- âœ… Reduce default fanout if bottlenecks persist

### 3ï¸âƒ£ SSH Key Authentication

**Problem**: Password prompts break parallel execution

**Solution**:
```bash
# Set up SSH key-based authentication
ssh-keygen -t rsa
ssh-copy-id user@node[1-100]

# Or use ssh-agent
eval $(ssh-agent)
ssh-add ~/.ssh/id_rsa
```

---

## ğŸ“š Documentation

### ğŸ“– Man Pages

Detailed documentation is available in the `doc/` directory:

- **pdsh(1)** - Main command reference
- **pdcp(1)** - Parallel copy utility
- **dshbak(1)** - Output formatting utility

```bash
man pdsh
man pdcp
man dshbak
```

### ğŸ”— Additional Resources

- **[README.modules](README.modules)** - Complete module documentation
- **[AUTHORS](AUTHORS)** - Project contributors
- **[COPYING](COPYING)** - License information

---

## ğŸ’¡ Advanced Examples

### Cluster Management

```bash
# Check which nodes are responding
pdsh -w node[1-100] -f 100 hostname

# Parallel copy files to all nodes
pdcp -w node[1-50] /etc/config.conf /etc/

# Gather system information
pdsh -w @compute "uname -a" | dshbak -c

# Parallel software deployment
pdsh -w cluster[01-99] "cd /opt/app && git pull && make install"
```

### SLURM Integration

```bash
# Run on allocated SLURM nodes
salloc -N 20
pdsh -w $(scontrol show hostnames) "nvidia-smi"

# Or use SLURM module directly
pdsh -g slurm "hostname; nvidia-smi"
```

### Output Formatting with dshbak

```bash
# Collate output by host
pdsh -w node[1-10] "df -h" | dshbak

# Consolidated output (group identical results)
pdsh -w node[1-100] "uptime" | dshbak -c
```

---

## ğŸ¤ Contributing & Support

### ğŸ‘¨â€ğŸ’» Author

**Jim Garlick** - [garlick@llnl.gov](mailto:garlick@llnl.gov)

### ğŸ’Œ Feedback Welcome

We'd love to hear from you! Please send:

- ğŸ› Bug reports and issues
- ğŸ’¡ Feature suggestions and improvements
- ğŸ“Š Usage reports (tell us about your cluster!)
- ğŸ“ Documentation improvements

### ğŸ“Š Usage Statistics

Running pdsh on an interesting cluster? We'd love to hear about:
- Number of nodes
- Use cases
- Performance observations
- Integration stories

---

## ğŸ“„ License & Attribution

This product includes software developed by the **University of California, Berkeley** and its contributors. Modifications have been made and bugs are probably mine.

**License**: GNU General Public License (GPL) - see [COPYING](COPYING) for details.

### â„¹ï¸ Important Note

The PDSH software package has **no affiliation** with the Democratic Party of Albania ([www.pdsh.org](http://www.pdsh.org)).

---

<div align="center">

### ğŸŒŸ Star this project if you find it useful! ğŸŒŸ

**[Documentation](doc/)** â€¢ **[Modules](README.modules)** â€¢ **[Contributing](AUTHORS)** â€¢ **[License](COPYING)**

Made with â¤ï¸ for system administrators and cluster operators everywhere

*Scaling operations, one parallel shell at a time*

</div>
